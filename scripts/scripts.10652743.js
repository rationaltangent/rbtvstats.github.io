"use strict";function binaryClosest(a,b){if(!b)return-1;var c,d,e=0,f=a.length-1;for(b=b._d.getTime();f>=e;){if(c=Math.floor((e+f)/2),d=a[c].time.getTime(),d===b||1>=f-e)return c;b>d?e=c+1:d>b&&(f=c-1)}return-1}function getPercentile(a,b){function c(a,b){return a.viewers<b.viewers?-1:a.viewers>b.viewers?1:0}b=b.concat().sort(c);var d=a/100*b.length,e=-1;return e=Math.floor(d)==d?(b[d-1].viewers+b[d].viewers)/2:b[Math.floor(d)].viewers}var app=angular.module("rbtvstatsApp",["ngRoute","ngTable","ngAnimate","chart.js","ui.bootstrap","ui.select","angular-loading-bar","duScroll","daterangepicker","angularMoment","uuid4"]);app.config(["$routeProvider","ChartJsProvider","cfpLoadingBarProvider",function(a,b,c){a.when("/channels",{templateUrl:"views/channels.html",controller:"ChannelsCtrl"}).when("/shows",{templateUrl:"views/shows.html",controller:"ShowsCtrl",reloadOnSearch:!1}).when("/hosts",{templateUrl:"views/hosts.html",controller:"HostsCtrl",reloadOnSearch:!1}).when("/videos",{templateUrl:"views/videos.html",controller:"VideosCtrl"}).when("/live",{templateUrl:"views/live.html",controller:"LiveCtrl",reloadOnSearch:!1}).otherwise({redirectTo:"/channels"}),c.includeSpinner=!1,c.latencyThreshold=500,b.setOptions({responsive:!0,maintainAspectRatio:!1,responsiveAnimationDuration:500})}]),app.run(["amMoment",function(a){a.changeLocale("de")}]),app.filter("duration",function(){return function(a){var b=Math.floor(a/86400),c=Math.floor(a%86400/3600),d=Math.floor(a%86400%3600/60),a=Math.floor(a%86400%3600%60),e="";return b>0&&(e+=b+" T "),c>0&&(e+=c+" h "),d>0&&(e+=d+" m "),a>=0&&0==b&&0==c&&(e+=a+" s "),e}}),app.filter("createDate",function(){return function(a){return a?new Date(1e3*a):void 0}}),app.filter("escape",function(){return window.encodeURIComponent}),app.service("StateSrv",["$rootScope",function(a){var b={};return b.save=function(b,c){var d=b.split("/");a.state=a.state||{},a.state[d[1]]=c},b.load=function(b,c){var d=b.split("/");return a.state=a.state||{},a.state[d[1]]||c},b}]),app.service("DataSrv",["$http","$q",function(a,b){var c=[],d=[],e={};return e.getVideoMetadata=function(){return a.get("https://raw.githubusercontent.com/rbtvstats/rbtvdata/master/video/metadata.json").then(function(a){return a.data})},e.getVideoData=function(d,e){function f(a){return 10>a?"0"+a:a}var g=[];for(e=e||new Date;e>=d;){var h=d.getFullYear()+"-"+f(d.getMonth()+1)+".json";-1==c.indexOf(h)&&(c.push(h),g.push(a.get("https://raw.githubusercontent.com/rbtvstats/rbtvdata/master/video/"+h))),d.setMonth(d.getMonth()+1)}return b.all(g).then(function(a){var b=[];if(a)for(var c=0;c<a.length;c++)b=b.concat(a[c].data);return b})},e.getLiveMetadata=function(){return a.get("https://raw.githubusercontent.com/rbtvstats/rbtvdata/master/live/metadata.json").then(function(a){return a.data})},e.getLiveData=function(c,e){function f(a){return 10>a?"0"+a:a}var g=[];for(e=e||new Date,e=new Date(e.getFullYear(),e.getMonth()),c=new Date(c.getFullYear(),c.getMonth());e>=c;){var h=c.getFullYear()+"-"+f(c.getMonth()+1)+".csv";-1==d.indexOf(h)&&(d.push(h),g.push(a.get("https://raw.githubusercontent.com/rbtvstats/rbtvdata/master/live/"+h))),c.setMonth(c.getMonth()+1)}return b.all(g).then(function(a){var b=[];if(a)for(var c=0;c<a.length;c++)for(var d=a[c].data,e=d.split("\n"),f=0;f<e.length;f++){var g=e[f].split(",");2===g.length&&b.push({time:new Date(1e3*parseInt(g[0],10)),viewers:parseInt(g[1],10)})}return b})},e}]),app.service("FlagSrv",["$http","uuid4",function(a,b){var c={};return c.flag=function(c){return a.put("https://rbtv-report.firebaseio.com/"+b.generate()+".json",c).then(function(a){return a})},c}]),app.controller("NavigationCtrl",["$scope","$location",function(a,b){a.isActive=function(a){return 0==b.path().indexOf(a)}}]),app.controller("ChannelsCtrl",["$scope","$rootScope","$location","$timeout","StateSrv","DataSrv",function(a,b,c,d,e,f){a.initFinished=!1,a.init=function(){a.model={},a.model.dataLatest=0,a.model.chartsConfig=[],a.model.charts=[],a.model.stats={},a.model.chartsConfig.push(g),a.model.chartsConfig.push(h),a.model.chartsConfig.push(i),a.model.chartsConfig.push(j),a.model.chartsConfig.push(k),a.model.chartsConfig.push(l),a.model=e.load(c.path(),a.model),a.$on("updateVideoData",function(b,c){a.update()}),a.update(),d(function(){a.initFinished=!0},100)},a.update=function(){a.model.dataLatest!=a.videoMetadata.time&&a.videoMetadata.time>0&&a.videos.length>0&&(a.model.dataLatest=a.videoMetadata.time,a.updateCharts(),a.updateStats())},a.updateCharts=function(){if(a.model.charts=[],a.videos.length>0)for(var b=0;b<a.model.chartsConfig.length;b++)a.model.chartsConfig[b]()},a.updateStats=function(){if(a.model.stats={},a.videos.length>0)for(var b=a.groupChannel(a.videos),c=0;c<b.length;c++){var d=b[c].key,e=b[c].value,f=[],g=e.length;f.push({title:"Anzahl Videos",value:{type:"number",text:g}});for(var h=0,i=0,j=0;j<e.length;j++)h+=e[j].stats.viewCount,i+=e[j].length;f.push({title:"Ø Views pro Video",value:{type:"number",text:Math.round(h/g)}}),f.push({title:"Ø Videolänge",value:{type:"duration",text:Math.round(i/g)}});for(var k=Number.MAX_VALUE,l=0,j=0;j<e.length;j++){var m=e[j];m.published<k&&(k=m.published),m.published>l&&(l=m.published)}k=new Date(1e3*k),l=new Date(1e3*l);var n=l-k;n/=864e5,f.push({title:"Ø Videos pro Tag",value:{type:"number",text:Math.round(g/n*100)/100}});for(var o=[null,null,null,null,null],j=0;j<e.length;j++)for(var m=e[j],p=0;p<o.length;p++)(null==o[p]||m.stats.viewCount>o[p].stats.viewCount)&&(o.splice(p,0,m),o.length=o.length-1,p=o.length);for(var q=[],j=0;j<o.length;j++){var m=o[j];null!=m&&q.push({type:"url",text:m.title,url:"https://www.youtube.com/watch?v="+m.id,info:m.stats.viewCount+" Views"})}f.push({title:"Top "+o.length+" meiste Views",value:q});for(var r=null,s=null,j=0;j<e.length;j++){var m=e[j];(null==r||m.stats.likeCount>r.stats.likeCount)&&(r=m),(null==s||m.stats.dislikeCount>s.stats.dislikeCount)&&(s=m)}f.push(f.mostLikes={title:"Meiste positive Bewertungen",value:{type:"url",text:r.title,url:"https://www.youtube.com/watch?v="+r.id,info:r.stats.likeCount+" Bewertungen"}}),f.push({title:"Meiste negative Bewertungen",value:{type:"url",text:s.title,url:"https://www.youtube.com/watch?v="+s.id,info:s.stats.dislikeCount+" Bewertungen"}}),a.model.stats[d]=f}};var g=function(){var b=a.groupMonthly(a.videos),c={};c.labels=[],c.series=[],c.data=[],c.options={type:"bar",header:"Monatliche Inhalte in Stunden pro Kanal",width:"100%",height:"400px",legend:{display:!0},scales:{xAxes:[{stacked:!0}],yAxes:[{stacked:!0,scaleLabel:{display:!0,labelString:"Stunden"}}]}},b.sort(a.orderKey);for(var d={},e=0;e<b.length;e++){for(var f=b[e],g=f.key.split("."),h=new Date(g[0],g[1]-1,1),i={},j=0;j<f.value.length;j++){var k=f.value[j].channel;i[k]=i[k]||0,i[k]+=f.value[j].length}for(var k in i)i[k]=Math.round(i[k]/3600*100)/100,d[k]=d[k]||[],d[k].push(i[k]);c.labels.push(a.monthShortNames[h.getMonth()]+" "+h.getFullYear())}for(var k in d)c.series.push(k),c.data.push(d[k]);a.model.charts.push(c)},h=function(){var b=a.groupMonthly(a.videos),c={};c.labels=[],c.series=[],c.data=[],c.options={type:"bar",header:"Monatliche Views pro Kanal",width:"100%",height:"400px",legend:{display:!0},scales:{xAxes:[{stacked:!0}],yAxes:[{stacked:!0,scaleLabel:{display:!0,labelString:"Views"}}]}},b.sort(a.orderKey);for(var d={},e=0;e<b.length;e++){for(var f=b[e],g=f.key.split("."),h=new Date(g[0],g[1]-1,1),i={},j=0;j<f.value.length;j++){var k=f.value[j].channel;i[k]=i[k]||0,f.value[j].stats||console.log(f.value[j]),i[k]+=Number(f.value[j].stats.viewCount)}for(var k in i)d[k]=d[k]||[],d[k].push(i[k]);c.labels.push(a.monthShortNames[h.getMonth()]+" "+h.getFullYear())}for(var k in d)c.series.push(k),c.data.push(d[k]);a.model.charts.push(c)},i=function(){var b=a.groupMonthly(a.videos),c={};c.labels=[],c.series=[],c.data=[],c.options={type:"bar",header:"Monatliche durchschnittliche Video Views pro Kanal",width:"100%",height:"500px",legend:{display:!0},scales:{xAxes:[{}],yAxes:[{scaleLabel:{display:!0,labelString:"Views"},ticks:{beginAtZero:!0}}]}},b.sort(a.orderKey);for(var d={},e=0;e<b.length;e++){for(var f=b[e],g=f.key.split("."),h=new Date(g[0],g[1]-1,1),i={},j={},k=0;k<f.value.length;k++){var l=f.value[k].channel;i[l]=i[l]||0,i[l]++,j[l]=j[l]||0,j[l]+=f.value[k].stats.viewCount}for(var l in j){var m=Math.round(j[l]/i[l]);d[l]=d[l]||[],d[l].push(m)}c.labels.push(a.monthShortNames[h.getMonth()]+" "+h.getFullYear())}for(var l in d)c.series.push(l),c.data.push(d[l]);a.model.charts.push(c)},j=function(){var b=a.groupChannel(a.videos),c={};c.labels=[],c.series=[],c.data=[],c.options={type:"bar",header:"Häufigkeitsverteilung der Views pro Kanal",width:"100%",height:"400px",legend:{display:!0},scales:{xAxes:[{stacked:!0,scaleLabel:{display:!0,labelString:"Views"}}],yAxes:[{stacked:!0,scaleLabel:{display:!0,labelString:"Anzahl Videos"},ticks:{beginAtZero:!0}}]}};for(var d=2e3,e={},f=0;f<b.length;f++){for(var g=b[f].key,h=b[f].value,i=0;i<h.length;i++){var j=h[i],k=Math.floor(j.stats.viewCount/d)*d;e[g]=e[g]||{},e[g][k]=e[g][k]||0,e[g][k]++}c.series.push(g)}var l=0,m=0,n=-1;for(var g in e)for(var k in e[g])m+=e[g][k],l++,Number(k)>Number(n)&&(n=Number(k));m/=l;for(var b={},o=!1,p={},q=5,r=.05,f=0;n>f&&!o;f+=d){c.labels.push(f/1e3+"k");for(var g in e){"number"!=typeof p[g]&&(p[g]=q);var s=e[g][f]||0;b[g]=b[g]||[],b[g].push(s),r*m>s&&p[g]--}o=!0;for(var g in p)o=o&&p[g]<=0}for(var g in b)c.data.push(b[g]);a.model.charts.push(c)},k=function(){var b=a.groupMonthly(a.videos),c={};c.labels=[],c.series=[],c.data=[],c.options={type:"bar",header:"Monatliche positive Bewertungen in Prozent pro Kanal",width:"100%",height:"500px",legend:{display:!0},scales:{xAxes:[{}],yAxes:[{scaleLabel:{display:!0,labelString:"Positive Bewertungen (%)"},ticks:{beginAtZero:!0}}]}},b.sort(a.orderKey);for(var d={},e=0;e<b.length;e++){for(var f=b[e],g=f.key.split("."),h=new Date(g[0],g[1]-1,1),i={},j=0;j<f.value.length;j++){var k=f.value[j].channel;i[k]=i[k]||{},i[k].likes=i[k].likes||0,i[k].dislikes=i[k].dislikes||0,i[k].likes+=Number(f.value[j].stats.likeCount),i[k].dislikes+=Number(f.value[j].stats.dislikeCount)}for(var k in i){var l=i[k].likes+i[k].dislikes,m=100*i[k].likes/l;m=Math.round(100*m)/100,d[k]=d[k]||[],d[k].push(m)}c.labels.push(a.monthShortNames[h.getMonth()]+" "+h.getFullYear())}for(var k in d)c.series.push(k),c.data.push(d[k]);a.model.charts.push(c)},l=function(){var b=a.groupHosts(a.videos),c={};c.labels=[],c.data=[],c.options={type:"doughnut",header:"Gesamte Inhalte in Stunden pro Person",width:"100%",height:"400px",legend:{display:!1}};for(var d=[],e=0;e<b.length;e++){for(var f=b[e],g=0,h=0;h<f.value.length;h++){var i=f.value[h];g+=i.length}g=Math.round(g/3600*100)/100,d.push({key:f.key,value:g})}d.sort(a.orderValue);for(var e=0;e<d.length;e++)c.labels.push(d[e].key),c.data.push(d[e].value);a.model.charts.push(c)};d(a.init,0)}]),app.controller("HostsCtrl",["$scope","$rootScope","$location","$timeout","StateSrv","DataSrv",function(a,b,c,d,e,f){a.initFinished=!1,a.init=function(){a["default"]={},a["default"].host="Eddy",a.model={},a.model.host=null,a.model.videos=[],a.model.chartsConfig=[],a.model.charts=[],a.model.stats={},a.model.chartsConfig.push(g),a.model.chartsConfig.push(h),a.model.chartsConfig.push(i),a.model=e.load(c.path(),a.model),a.host={selected:a.getHost()||a.model.host||a["default"].host},a.$on("updateVideoData",function(b,c){a.update()}),a.$watch("host.selected",function(b,d){var e={};a.host.selected&&(e.host=a.host.selected),c.search(e),a.update()}),a.$on("$routeUpdate",function(b,c){a.host.selected=a.getHost()||a.model.host||a["default"].host}),d(function(){a.initFinished=!0},100)},a.getHost=function(){var a=null,b=c.search();for(var d in b)"boolean"==typeof b[d]&&(a=d);return"undefined"!=typeof b.host&&(a=b.host),a},a.update=function(){a.host.selected!=a.model.host&&a.hosts.indexOf(a.host.selected)>-1&&(a.model.host=a.host.selected,a.assignArray(a.model.videos,a.filterHost(a.videos,a.model.host)),a.updateCharts(),a.updateStats())},a.updateCharts=function(){a.model.charts=[];for(var b=0;b<a.model.chartsConfig.length;b++)a.model.chartsConfig[b]()},a.updateStats=function(){a.model.stats={};var b=a.model.videos,c=[],d=b.length;c.push({title:"Anzahl Videos",value:{type:"number",text:d}});for(var e=0,f=0;f<b.length;f++)e+=b[f].stats.viewCount;c.push({title:"Ø Views pro Video",value:{type:"number",text:Math.round(e/d)}});for(var g=Number.MAX_VALUE,h=0,f=0;f<b.length;f++){var i=b[f];i.published<g&&(g=i.published),i.published>h&&(h=i.published)}g=new Date(1e3*g),h=new Date(1e3*h);var j=h-g;j/=864e5,c.push({title:"Ø Videos pro Tag",value:{type:"number",text:Math.round(d/j*100)/100}});for(var k=0,f=0;f<b.length;f++){var i=b[f],l=i.hosts||[];1==l.length&&l[0]==a.model.host&&k++}c.push({title:"Videos ohne Co-Moderatoren",value:{type:"number",text:k}});for(var m={},f=0;f<b.length;f++)for(var i=b[f],l=i.hosts||[],n=0;n<l.length;n++){var o=l[n];o!=a.model.host&&(m[o]=m[o]||{},m[o].count=m[o].count||0,m[o].count++)}var p=[null,null,null,null,null];for(var o in m)for(var n=0;n<p.length;n++)(null==p[n]||m[o].count>p[n].count)&&(p.splice(n,0,{name:o,count:m[o].count}),p.length=p.length-1,n=p.length);for(var q=[],f=0;f<p.length;f++){var r=p[f];null!=r&&q.push({type:"url",text:r.name,url:"#/hosts?host="+window.encodeURIComponent(r.name),info:r.count+" Videos"})}c.push({title:"Top "+p.length+" Co-Moderatoren",value:q});for(var s={},f=0;f<b.length;f++)for(var i=b[f],t=i.shows||[],n=0;n<t.length;n++){var u=t[n];s[u]=s[u]||{},s[u].count=s[u].count||0,s[u].count++}var v=[null,null,null,null,null];for(var u in s)for(var n=0;n<v.length;n++)(null==v[n]||s[u].count>v[n].count)&&(v.splice(n,0,{name:u,count:s[u].count}),v.length=v.length-1,n=v.length);for(var q=[],f=0;f<v.length;f++){var w=v[f];null!=w&&q.push({type:"url",text:w.name,url:"#/shows?show="+window.encodeURIComponent(w.name),info:w.count+" Videos"})}c.push({title:"Top "+v.length+" Formate",value:q});for(var x=[null,null,null,null,null],f=0;f<b.length;f++)for(var i=b[f],n=0;n<x.length;n++)(null==x[n]||i.stats.viewCount>x[n].stats.viewCount)&&(x.splice(n,0,i),x.length=x.length-1,n=x.length);for(var q=[],f=0;f<x.length;f++){var i=x[f];null!=i&&q.push({type:"url",text:i.title,url:"https://www.youtube.com/watch?v="+i.id,info:i.stats.viewCount+" Views"})}c.push({title:"Top "+x.length+" meiste Views",value:q});for(var y=null,z=null,f=0;f<b.length;f++){var i=b[f];(null==y||i.stats.likeCount>y.stats.likeCount)&&(y=i),(null==z||i.stats.dislikeCount>z.stats.dislikeCount)&&(z=i)}c.push(c.mostLikes={title:"Meiste positive Bewertungen",value:{type:"url",text:y.title,url:"https://www.youtube.com/watch?v="+y.id,info:y.stats.likeCount+" Bewertungen"}}),c.push({title:"Meiste negative Bewertungen",value:{type:"url",text:z.title,url:"https://www.youtube.com/watch?v="+z.id,info:z.stats.dislikeCount+" Bewertungen"}}),a.model.stats=c};var g=function(){var b=a.model.videos,c={};c.labels=[],c.series=[],c.data=[[]],c.options={type:"bar",header:"Häufigkeitsverteilung der Views",width:"100%",height:"400px",legend:{display:!1},scales:{xAxes:[{scaleLabel:{display:!0,labelString:"Views"}}],yAxes:[{scaleLabel:{display:!0,labelString:"Anzahl Videos"},ticks:{beginAtZero:!0}}]}};for(var d=2e3,e=0,f={},g=0;g<b.length;g++){var h=b[g],i=Math.floor(h.stats.viewCount/d)*d;e+=h.stats.viewCount,f[i]=f[i]||0,f[i]++}c.series.push(a.model.host);var j=0,k=0,l=-1;for(var i in f)k+=f[i],j++,Number(i)>Number(l)&&(l=Number(i));for(var m=k/j,n=Math.floor(e/b.length/d)*d,o=10,p=o,q=.1,r=n;p>0;r+=d){var s=f[r]||0;c.labels.push(r/1e3+"k"),c.data[0].push(s),q*m>s&&p--}p=o;for(var r=n-d;r>=0&&p>0;r-=d){var s=f[r]||0;c.labels.unshift(r/1e3+"k"),c.data[0].unshift(s),q*m>s&&p--}a.model.charts.push(c)},h=function(){var b=a.groupMonthly(a.model.videos),c={};c.labels=[],c.series=[],c.data=[],c.options={type:"bar",header:"Monatliche durchschnittliche Video Views",width:"100%",height:"500px",legend:{display:!1},scales:{xAxes:[{}],yAxes:[{scaleLabel:{display:!0,labelString:"Views"},ticks:{beginAtZero:!0}}]}},b.sort(a.orderKey),c.series.push(a.model.host);for(var d=[],e=0;e<b.length;e++){for(var f=b[e],g=f.key.split("."),h=new Date(g[0],g[1]-1,1),i=0,j=0,k=0;k<f.value.length;k++){f.value[k].channel;i=i||0,i++,j=j||0,j+=f.value[k].stats.viewCount}var l=Math.round(j/i);d.push(l),c.labels.push(a.monthShortNames[h.getMonth()]+" "+h.getFullYear())}c.data.push(d),a.model.charts.push(c)},i=function(){var b=a.groupMonthly(a.model.videos),c={};c.labels=[],c.series=[],c.data=[[]],c.options={type:"bar",header:"Monatliche Inhalte in Stunden",width:"100%",height:"400px",legend:{display:!1},scales:{xAxes:[{}],yAxes:[{scaleLabel:{display:!0,labelString:"Stunden"},ticks:{beginAtZero:!0}}]}},b.sort(a.orderKey);for(var d=0;d<b.length;d++){for(var e=b[d],f=e.key.split("."),g=new Date(f[0],f[1]-1,1),h=0,i=0;i<e.value.length;i++)h=h||0,h+=e.value[i].length;h=Math.round(h/3600*100)/100,c.labels.push(a.monthShortNames[g.getMonth()]+" "+g.getFullYear()),c.data[0].push(h)}c.series.push(a.model.host),a.model.charts.push(c)};d(a.init,0)}]),app.controller("ShowsCtrl",["$scope","$rootScope","$location","$timeout","StateSrv","DataSrv",function(a,b,c,d,e,f){a.initFinished=!1,a.init=function(){a["default"]={},a["default"].show="Bohn Jour",a.model={},a.model.show=null,a.model.series=null,a.model.seriesList=[],a.model.videos=[],a.model.chartsConfig=[],a.model.charts=[],a.model.stats={},a.model.chartsConfig.push(g),a.model.chartsConfig.push(h),a.model=e.load(c.path(),a.model),a.show={selected:a.getShow()||a.model.show||a["default"].show},a.series={selected:a.getSeries()||a.model.series},a.$on("updateVideoData",function(b,c){a.update()}),a.$watchGroup(["show.selected","series.selected"],function(b,d){var e={};a.show.selected&&(e.show=a.show.selected),a.series.selected&&(e.series=a.series.selected),c.search(e),a.update()}),a.$on("$routeUpdate",function(b,c){a.show.selected=a.getShow()||a.model.show||a["default"].show,a.series.selected=a.getSeries()}),d(function(){a.initFinished=!0},100)},a.getShow=function(){var a=null,b=c.search();for(var d in b)"boolean"==typeof b[d]&&(a=d);return"undefined"!=typeof b.show&&(a=b.show),a},a.getSeries=function(){var a=null,b=c.search();return"undefined"!=typeof b.series&&(a=b.series),a},a.update=function(){(a.show.selected!=a.model.show||a.series.selected!=a.model.series)&&a.shows.indexOf(a.show.selected)>-1&&(a.model.show=a.show.selected,a.model.series=a.series.selected,a.updateSeries(),a.assignArray(a.model.videos,a.filterShow(a.videos,a.model.show)),a.model.seriesList.indexOf(a.series.selected)>-1?a.assignArray(a.model.videos,a.filterSeries(a.model.videos,a.model.series)):setTimeout(function(){a.series.selected=null},0),a.updateCharts(),a.updateStats())},a.updateSeries=function(){for(var b=[],c=a.filterShow(a.videos,a.model.show),d=0;d<c.length;d++)for(var e=c[d],f=e.series||[],g=0;g<f.length;g++){var h=f[g];-1==b.indexOf(h)&&b.push(h)}a.model.seriesList=b},a.updateCharts=function(){a.model.charts=[];for(var b=0;b<a.model.chartsConfig.length;b++)a.model.chartsConfig[b]()},a.updateStats=function(){a.model.stats={};var b=a.model.videos,c=[],d=b.length;c.push({title:"Anzahl Videos",value:{type:"number",text:d}});for(var e=0,f=0;f<b.length;f++)e+=b[f].stats.viewCount;c.push({title:"Ø Views pro Video",value:{type:"number",text:Math.round(e/d)}});for(var g={},f=0;f<b.length;f++)for(var h=b[f],i=h.hosts||[],j=0;j<i.length;j++){var k=i[j];g[k]=g[k]||{},g[k].count=g[k].count||0,g[k].count++}var l=[null,null,null,null,null];for(var k in g)for(var j=0;j<l.length;j++)(null==l[j]||g[k].count>l[j].count)&&(l.splice(j,0,{name:k,count:g[k].count}),l.length=l.length-1,j=l.length);for(var m=[],f=0;f<l.length;f++){var n=l[f];null!=n&&m.push({type:"url",text:n.name,url:"#/hosts?host="+n.name,info:n.count+" Videos"})}c.push({title:"Top "+l.length+" Moderatoren",value:m});for(var o=[null,null,null,null,null],f=0;f<b.length;f++)for(var h=b[f],j=0;j<o.length;j++)(null==o[j]||h.stats.viewCount>o[j].stats.viewCount)&&(o.splice(j,0,h),o.length=o.length-1,j=o.length);for(var m=[],f=0;f<o.length;f++){var h=o[f];null!=h&&m.push({type:"url",text:h.title,url:"https://www.youtube.com/watch?v="+h.id,info:h.stats.viewCount+" Views"})}c.push({title:"Top "+o.length+" meiste Views",value:m});for(var p=null,q=null,f=0;f<b.length;f++){var h=b[f];(null==p||h.stats.likeCount>p.stats.likeCount)&&(p=h),(null==q||h.stats.dislikeCount>q.stats.dislikeCount)&&(q=h)}c.push(c.mostLikes={title:"Meiste positive Bewertungen",value:{type:"url",text:p.title,url:"https://www.youtube.com/watch?v="+p.id,info:p.stats.likeCount+" Bewertungen"}}),c.push({title:"Meiste negative Bewertungen",value:{type:"url",text:q.title,url:"https://www.youtube.com/watch?v="+q.id,info:q.stats.dislikeCount+" Bewertungen"}}),a.model.stats=c};var g=function(){var b=a.model.videos,c={};c.labels=[],c.series=[],c.data=[[]],c.options={type:"bar",header:"Häufigkeitsverteilung der Views",width:"100%",height:"400px",legend:{display:!1},scales:{xAxes:[{scaleLabel:{display:!0,labelString:"Views"}}],yAxes:[{scaleLabel:{display:!0,labelString:"Anzahl Videos"},ticks:{beginAtZero:!0}}]}};for(var d=2e3,e=0,f={},g=0;g<b.length;g++){var h=b[g],i=Math.floor(h.stats.viewCount/d)*d;e+=h.stats.viewCount,f[i]=f[i]||0,f[i]++}c.series.push(a.model.show);var j=0,k=0,l=-1;for(var i in f)k+=f[i],j++,Number(i)>Number(l)&&(l=Number(i));for(var m=k/j,n=Math.floor(e/b.length/d)*d,o=10,p=o,q=.1,r=n;p>0;r+=d){var s=f[r]||0;c.labels.push(r/1e3+"k"),c.data[0].push(s),q*m>s&&p--}p=o;for(var r=n-d;r>=0&&p>0;r-=d){var s=f[r]||0;c.labels.unshift(r/1e3+"k"),c.data[0].unshift(s),q*m>s&&p--}a.model.charts.push(c)},h=function(){var b=a.groupMonthly(a.model.videos),c={};c.labels=[],c.series=[],c.data=[],c.options={type:"bar",header:"Monatliche durchschnittliche Video Views",width:"100%",height:"500px",legend:{display:!1},scales:{xAxes:[{}],yAxes:[{scaleLabel:{display:!0,labelString:"Views"},ticks:{beginAtZero:!0}}]}},b.sort(a.orderKey),c.series.push(a.model.show);for(var d=[],e=0;e<b.length;e++){for(var f=b[e],g=f.key.split("."),h=new Date(g[0],g[1]-1,1),i=0,j=0,k=0;k<f.value.length;k++){f.value[k].channel;i=i||0,i++,j=j||0,j+=f.value[k].stats.viewCount}var l=Math.round(j/i);d.push(l),c.labels.push(a.monthShortNames[h.getMonth()]+" "+h.getFullYear())}c.data.push(d),a.model.charts.push(c)};d(a.init,0)}]),app.controller("VideosCtrl",["$scope","$rootScope","$location","$timeout","NgTableParams","StateSrv","DataSrv",function(a,b,c,d,e,f,g){a.initFinished=!1,a.init=function(){a.model={},a.model=f.load(c.path(),a.model),d(function(){a.initFinished=!0},100)},d(a.init,0)}]),app.controller("LiveCtrl",["$scope","$rootScope","$location","$timeout","StateSrv","DataSrv",function(a,b,c,d,e,f){a.initFinished=!1,a.init=function(){a.updateChartState=!1,a.model={},a.model.stats={},a.model.dateRange={startDate:null,endDate:null},a.model.dateRangeOptions={showDropdowns:!0,timePicker:!0,timePicker24Hour:!0,locale:{format:"DD.MM.YYYY",separator:" - ",applyLabel:"Anwenden",cancelLabel:"Abbrechen",fromLabel:"Bis",toLabel:"Von",customRangeLabel:"Manuell",weekLabel:"W",daysOfWeek:["So","Mo","Di","Mi","Do","Fr","Sa"],monthNames:["Januar","Frebruar","März","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"],firstDay:1},ranges:{}},a.model=e.load(c.path(),a.model),a.dateRange={startDate:a.getFrom()||a.model.dateRange.startDate,endDate:a.getTo()||a.model.dateRange.endDate},a.liveMetadata.last&&!a.dateRange.startDate&&(a.dateRange.startDate=moment(1e3*a.liveMetadata.last).subtract(24,"h")),a.liveMetadata.last&&!a.dateRange.endDate&&(a.dateRange.endDate=moment(1e3*a.liveMetadata.last)),a.$on("updateLiveData",function(b,c){a.liveMetadata.last&&!a.dateRange.startDate&&(a.dateRange.startDate=moment(1e3*a.liveMetadata.last).subtract(24,"h")),a.liveMetadata.last&&!a.dateRange.endDate&&(a.dateRange.endDate=moment(1e3*a.liveMetadata.last)),a.updateDatePicker(),a.update()}),a.$watch("dateRange",function(b,d){var e={};a.dateRange.startDate&&(e.from=a.dateRange.startDate.unix()),a.dateRange.endDate&&(e.to=a.dateRange.endDate.unix()),c.search(e),a.update()},!0),a.$on("$routeUpdate",function(b,c){a.dateRange={startDate:a.getFrom()||a.model.dateRange.startDate,endDate:a.getTo()||a.model.dateRange.endDate}}),a.updateDatePicker(),d(function(){a.initFinished=!0},100)},a.getFrom=function(){var a=null,b=c.search();return"undefined"!=typeof b.from&&(a=moment.unix(parseInt(b.from,10))),a},a.getTo=function(){var a=null,b=c.search();return"undefined"!=typeof b.to&&(a=moment.unix(parseInt(b.to,10))),a},a.changeDate=function(b,c){0>b?(b=Math.abs(b),a.dateRange.startDate.subtract(b,c),a.dateRange.endDate.subtract(b,c)):(a.dateRange.startDate.add(b,c),a.dateRange.endDate.add(b,c));var d=a.dateRange.endDate.diff(a.dateRange.startDate)/1e3;(a.dateRange.startDate<a.model.dateRangeOptions.minDate||a.dateRange.endDate<a.model.dateRangeOptions.minDate)&&(a.dateRange.startDate=moment(a.model.dateRangeOptions.minDate),a.dateRange.endDate=moment(a.model.dateRangeOptions.minDate).add(d,"s")),(a.dateRange.startDate>a.model.dateRangeOptions.maxDate||a.dateRange.endDate>a.model.dateRangeOptions.maxDate)&&(a.dateRange.startDate=moment(a.model.dateRangeOptions.maxDate).subtract(d,"s"),a.dateRange.endDate=moment(a.model.dateRangeOptions.maxDate))},a.update=function(){a.dateRange.startDate&&a.dateRange.endDate&&(a.dateRange.startDate.isSame(a.model.dateRange.startDate)&&a.dateRange.endDate.isSame(a.model.dateRange.endDate)||(a.model.dateRange.startDate=moment(a.dateRange.startDate),a.model.dateRange.endDate=moment(a.dateRange.endDate),a.updateChart()))},a.updateDatePicker=function(){a.model.dateRangeOptions.minDate=moment(1e3*a.liveMetadata.first),a.model.dateRangeOptions.maxDate=moment(1e3*a.liveMetadata.last),a.model.dateRangeOptions.ranges={};var b=moment(a.model.dateRangeOptions.maxDate),c=moment(b).subtract(8,"h");a.model.dateRangeOptions.ranges["Letzten 8 Stunden"]=[c,b],c=moment(b).subtract(24,"h"),a.model.dateRangeOptions.ranges["Letzten 24 Stunden"]=[c,b],c=moment(b).subtract(7,"d"),a.model.dateRangeOptions.ranges["Letzten 7 Tage"]=[c,b],c=moment(b).subtract(1,"M"),a.model.dateRangeOptions.ranges["Letzter Monat"]=[c,b],c=moment(b).subtract(1,"y"),a.model.dateRangeOptions.ranges["Letztes Jahr"]=[c,b]},a.updateChart=function(){a.updateChartState||(a.updateChartState=!0,a.model.stats=[],d(function(){var b=a.dateRange.startDate.toDate(),c=a.dateRange.endDate.toDate();a.fetchLiveData(b,c).then(function(){var b={};if(a.live.length>0){b.labels=[],b.series=[],b.data=[[]],b.options={type:"line",header:"Live Views",width:"100%",height:"430px",legend:{display:!1},elements:{point:{radius:0,hitRadius:5}},scales:{xAxes:[{type:"time",ticks:{minRotation:60,maxRotation:60},time:{displayFormats:{second:"HH:mm",minute:"HH:mm",hour:"HH:mm",day:"DD.MM.YY",week:"DD.MM.YY",month:"DD.MM.YY",quarter:"DD.MM.YY",year:"DD.MM.YY"}}}],yAxes:[{stacked:!0,scaleLabel:{display:!0,labelString:"Views"}}]}},b.series.push("Live Views");var c=4e3,d=binaryClosest(a.live,a.dateRange.startDate),e=binaryClosest(a.live,a.dateRange.endDate),f=e-d,g=1;if(f>c&&(g=Math.floor(f/c)),d>-1&&e>-1){for(var h=d;e>=h;h+=g){var i=a.live[h];b.labels.push(moment(i.time)),b.data[0].push(i.viewers)}a.updateStats(a.live.slice(d,e))}}a.model.chart=b,a.updateChartState=!1})},100))},a.updateStats=function(b){var c=[];if(b.length>0){var d=b[0];c.push({title:"Ältester Datenpunkt",value:{type:"text",text:moment(d.time).format("LLLL")}});var e=b[b.length-1];c.push({title:"Neuster Datenpunkt",value:{type:"text",text:moment(e.time).format("LLLL")}});var f=b.length;c.push({title:"Anzahl Datenpunkte",value:{type:"number",text:f}});for(var g=Number.POSITIVE_INFINITY,h=-1,i=Number.NEGATIVE_INFINITY,j=-1,k=0;k<b.length;k++){var l=b[k].viewers;g>l&&(h=k,g=l),l>i&&(j=k,i=l)}var m=b[h];c.push({title:"Minimum",value:{type:"number",text:moment(m.time).format("LLLL")+" - "+m.viewers}});var n=b[j];c.push({title:"Maximum",value:{type:"number",text:moment(n.time).format("LLLL")+" - "+n.viewers}});for(var o=0,k=0;k<b.length;k++)o+=b[k].viewers;var p=Math.round(o/f);c.push({title:"Durchschnitt",value:{type:"number",text:p}});var q=getPercentile(25,b);c.push({title:"Quartil 25%",value:{type:"number",text:q}});var r=getPercentile(50,b);c.push({title:"Quartil 50% (Median)",value:{type:"number",text:r}});var s=getPercentile(75,b);c.push({title:"Quartil 75%",value:{type:"number",text:s}})}a.model.stats=c},d(a.init,0)}]),app.controller("DataCtrl",["$scope","$rootScope","$document","$q","$timeout","$filter","uuid4","StateSrv","DataSrv",function(a,b,c,d,e,f,g,h,i){a.init=function(){b.state={},a.fetchVideoDataState=!1,a.fetchLiveDataState=!1,a.videoMetadata={},a.liveMetadata={},a.videos=[],a.live=[],a.channels=[],a.shows=[],a.hosts=[],a.monthShortNames=["Jan","Feb","Mär","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"],b.alerts=[],a.$on("$routeChangeStart",function(a,b,c){"undefined"!=typeof c&&"undefined"!=typeof c.scope&&h.save(c.originalPath,c.scope.model)}),a.update()},a.findByKey=function(a,b){for(var c=0;c<a.length;c++)if(a[c].key==b)return a[c];var d={key:b,value:[]};return a.push(d),d},a.filterChannel=function(a,b){for(var c=[],d=0;d<a.length;d++){var e=a[d];e.channel==b&&c.push(e)}return c},a.filterHost=function(a,b){for(var c=[],d=0;d<a.length;d++){var e=a[d];e.hosts&&e.hosts.indexOf(b)>-1&&c.push(e)}return c},a.filterShow=function(a,b){for(var c=[],d=0;d<a.length;d++){var e=a[d];e.shows&&e.shows.indexOf(b)>-1&&c.push(e)}return c},a.filterSeries=function(a,b){for(var c=[],d=0;d<a.length;d++){var e=a[d];e.series&&e.series.indexOf(b)>-1&&c.push(e)}return c},a.filterTime=function(a,b,c){var d=[];b=b||new Date,c=c||new Date;for(var e=0;e<a.length;e++){var f=a[e],g=new Date(1e3*f.published);g>b&&c>g&&d.push(f)}return d},a.groupChannel=function(b){for(var c=[],d=0;d<b.length;d++){var e=b[d],f=a.findByKey(c,e.channel);f.value.push(e)}return c},a.groupMonthly=function(b){for(var c=[],d=Number.MAX_VALUE,e=0,f=0;f<b.length;f++){var g=b[f];g.published<d&&(d=g.published),g.published>e&&(e=g.published)}for(d=new Date(1e3*d),e=new Date(1e3*e);e>d;){var h=d.getFullYear()+"."+(d.getMonth()+1<10?"0":"")+(d.getMonth()+1);a.findByKey(c,h),d.setMonth(d.getMonth()+1)}for(var f=0;f<b.length;f++){var g=b[f],i=new Date(1e3*g.published),h=i.getFullYear()+"."+(i.getMonth()+1<10?"0":"")+(i.getMonth()+1),j=a.findByKey(c,h);j.value.push(g)}return c},a.groupHosts=function(b){for(var c=[],d=0;d<b.length;d++)for(var e=b[d],f=e.hosts||[],g=0;g<f.length;g++){var h=f[g],i=a.findByKey(c,h);i.value.push(e)}return c},a.orderKey=function(a,b){return a.key<b.key?-1:a.key>b.key?1:0},a.orderValue=function(a,b){return a.value<b.value?-1:a.value>b.value?1:0},a.getAllShows=function(a){for(var b=[],c=0;c<a.length;c++)for(var d=a[c].shows||[],e=0;e<d.length;e++){var f=d[e];f&&b.indexOf(f)<0&&b.push(f)}return b.sort(),b},a.getAllHosts=function(a){for(var b=[],c=0;c<a.length;c++)for(var d=a[c].hosts||[],e=0;e<d.length;e++){var f=d[e];f&&b.indexOf(f)<0&&b.push(f)}return b.sort(),b},a.getAllChannels=function(a){for(var b=[],c=0;c<a.length;c++){var d=a[c].channel;d&&b.indexOf(d)<0&&b.push(d)}return b.sort(),b},a.toList=function(a){return $.isArray(a)?a.join(", "):""},a.assignArray=function(a,b){a.length=0;for(var c=0;c<b.length;c++)a.push(b[c])},b.addAlert=function(a){a.id=g.generate(),b.alerts.push(a),e(b.closeAlert,3e3,!0,a.id)},b.closeAlert=function(a){for(var c=0;c<b.alerts.length;c++){var d=b.alerts[c];d.id===a&&b.alerts.splice(c,1)}},a.fetchVideoMetadata=function(){return i.getVideoMetadata().then(function(b){a.videoMetadata=b})},a.fetchVideoData=function(b,c){return a.fetchVideoDataState?d.resolve():(a.fetchVideoDataState=!0,b=b||new Date(1e3*a.videoMetadata.first),b=new Date(b.getTime()),c=c||new Date,c=new Date(c.getTime()),i.getVideoData(b,c).then(function(b){a.assignArray(a.videos,b),a.assignArray(a.shows,a.getAllShows(a.videos)),a.assignArray(a.hosts,a.getAllHosts(a.videos)),a.assignArray(a.channels,a.getAllChannels(a.videos)),a.fetchVideoDataState=!1;
}))},a.fetchLiveMetadata=function(){return i.getLiveMetadata().then(function(b){a.liveMetadata=b})},a.fetchLiveData=function(b,c){return a.fetchLiveDataState?d.resolve():(a.fetchLiveDataState=!0,b=b||new Date,b=new Date(b.getTime()),c=c||new Date,c=new Date(c.getTime()),i.getLiveData(b,c).then(function(b){b=b.concat(a.live),b=f("orderBy")(b,"time"),a.assignArray(a.live,b),a.fetchLiveDataState=!1}))},a.update=function(){a.fetchVideoMetadata().then(function(){return a.fetchVideoData()}).then(function(){a.$broadcast("updateVideoData")}),a.fetchLiveMetadata().then(function(){a.$broadcast("updateLiveData")})},a.init()}]),app.controller("FlagCtrl",["$scope","$uibModalInstance",function(a,b){a.init=function(){a.reasons=[{id:"hosts",title:"Moderator(en) fehlerhaft oder unvollständig",selected:!1},{id:"shows",title:"Format(e) fehlerhaft oder unvollständig",selected:!1},{id:"series",title:"Serie(n) fehlerhaft oder unvollständig",selected:!1}],a.description=""},a.ok=function(){for(var c=[],d=0;d<a.reasons.length;d++){var e=a.reasons[d];e.selected===!0&&c.push(e.id)}a.description=a.description.trim(),a.description&&c.push("description: "+a.description),b.close(c)},a.cancel=function(){b.dismiss("cancel")},a.init()}]),app.directive("stat",function(){return{templateUrl:"views/template-stat.html",restrict:"A",scope:{value:"=stat"},controller:["$scope",function(a){a.getType=function(a){return $.isArray(a)?"array":typeof a}}]}}),app.directive("blank",["$document",function(a){return{restrict:"A",link:function(b,c,d){var e=d.href||d.ngHref;if(0!=e.indexOf("#"))c.attr("target","_blank");else{var f=d.scrollTo,g=angular.element(document.getElementById(f));g.length&&a.scrollToElementAnimated(g)}}}}]),app.directive("videos",["$rootScope","uuid4","FlagSrv",function(a,b,c){return{templateUrl:"views/template-videos.html",restrict:"A",scope:{data:"=videos",tableParams:"=params"},controller:["$scope","$rootScope","$timeout","$filter","$document","$uibModal","NgTableParams",function(a,b,d,e,f,g,h){a.init=function(){a.tableParams instanceof h||(a.tableParams=new h({sorting:{published:"desc"},count:25},{dataset:a.data,filterOptions:{filterFn:a.customFilter}})),a.$watchCollection("data",function(b,c){b.length!=c.length&&a.update()})},a.getLiveFrom=function(a){if(a.aired){var b=new Date(1e3*a.aired);return b.setHours(0,0,0),b.getTime()/1e3}},a.getLiveTo=function(a){if(a.aired){var b=new Date(1e3*a.aired);return b.setHours(23,59,59),b.getTime()/1e3}},a.scrollTop=function(){var a=angular.element(document.getElementById("top"));f.scrollToElementAnimated(a)},a.customFilter=function(a,b,c){var d=a,f=e("filter");for(var g in b){var h="channel"==g||c,i={};i[g]=b[g],d=f(d,i,h)}return d},a.getSelectFilter=function(b){function c(a,b){return a.title<b.title?-1:a.title>b.title?1:0}var d=[],e=function(){if($.isArray(a.data)){var e=[];d.length=0;for(var f=0;f<a.data.length;f++){var g=a.data[f],h=g[b];-1==e.indexOf(h)&&(e.push(h),d.push({id:h,title:h}))}d.push({id:"",title:""}),d.sort(c)}};return a.$watchCollection("data",function(a,b){a.length!=b.length&&e()}),e(),d},a.openFlagDialog=function(a){var d=g.open({animation:!0,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:"views/template-flag.html",controller:"FlagCtrl"});d.result.then(function(d){var e={videoId:a,reasons:d};c.flag(e).then(function(){b.addAlert({type:"success",msg:"Video erfolgreich gemeldet. Danke!"})},function(a){b.addAlert({type:"danger",msg:"Ein Fehler ist beim Melden des Videos aufgetreten. (status: "+a.status+")"})})},function(){})},a.update=function(){a.tableParams.reload()},a.init()}],link:function(a,b,c){}}}]),app.directive("animateChange",["$animate","$timeout",function(a,b){return function(c,d,e){c.$watch(e.animateChange,function(c,e){var f="change";a.addClass(d,f).then(function(){b(function(){a.removeClass(d,f)})})})}}]),angular.module("rbtvstatsApp").run(["$templateCache",function(a){a.put("views/channels.html",'<div class="content max-width fade-animate" ng-if="initFinished"> <div class="stats panel panel-default fade-animate" ng-repeat="(channel, stats) in model.stats"> <div class="panel-heading"><strong>{{channel}} Statistiken</strong></div> <div class="panel-body"> <div class="container-fluid"> <div class="row" ng-repeat="stat in stats"> <div class="col-md-3"><strong>{{stat.title}}</strong></div> <div class="col-md-9"> <div stat="stat.value"></div> </div> </div> </div> </div> </div> <div class="chart panel panel-default fade-animate" ng-repeat="chart in model.charts"> <div class="panel-heading"><strong>{{chart.options.header}}</strong></div> <div class="panel-body" style="width:{{chart.options.width}}; height: {{chart.options.height}}"> <canvas class="chart-base" chart-type="chart.options.type" chart-options="chart.options" chart-data="chart.data" chart-labels="chart.labels" chart-series="chart.series"></canvas> </div> </div> </div>'),a.put("views/hosts.html",'<div class="content max-width fade-animate" ng-if="initFinished"> <div class="select"> <div class="select-heading container-fluid" ng-if="hosts.length"> <div class="row"> <div class="col-md-3 form-group"> <label>Moderator</label> <ui-select ng-model="host.selected"> <ui-select-match placeholder="Auswählen.."> <span ng-bind="$select.selected"></span> </ui-select-match> <ui-select-choices repeat="item in (hosts | filter: $select.search | orderBy)"> <span ng-bind="item"></span> </ui-select-choices> </ui-select> </div> </div> </div> <div class="select-body"> <div class="select-content fade-animate" animate-change="model.host" ng-if="model.host == host.selected"> <div class="stats panel panel-default" ng-if="model.stats.length"> <div class="panel-heading"><strong>Statistiken</strong></div> <div class="panel-body"> <div class="container-fluid"> <div class="row" ng-repeat="stat in model.stats"> <div class="col-md-3"><strong>{{stat.title}}</strong></div> <div class="col-md-9"> <div stat="stat.value"></div> </div> </div> </div> </div> </div> <div class="chart panel panel-default" ng-repeat="chart in model.charts"> <div class="panel-heading"><strong>{{chart.options.header}}</strong></div> <div class="panel-body" style="width:{{chart.options.width}}; height: {{chart.options.height}}"> <canvas class="chart-base" chart-type="chart.options.type" chart-options="chart.options" chart-data="chart.data" chart-labels="chart.labels" chart-series="chart.series"></canvas> </div> </div> <div class="panel panel-default" ng-if="model.videos.length"> <div class="panel-heading"><strong>Videos</strong></div> <div class="panel-body container-table"> <div params="model.tableParams" videos="model.videos"></div> </div> </div> </div> </div> </div> </div>'),a.put("views/live.html",'<div class="content max-width fade-animate" ng-if="initFinished"> <div class="chart panel panel-default"> <div class="panel-heading"><strong>Live Views</strong></div> <div class="panel-body" style="width:{{model.chart.options.width}}; height: 500px"> <div class="live-header"> <a href="javascript:void(0);" date-range-picker class="date-picker" options="model.dateRangeOptions" ng-model="$parent.dateRange"> {{dateRange.startDate | amDateFormat:\'DD. MMMM YYYY HH:mm\'}} — {{dateRange.endDate | amDateFormat:\'DD. MMMM YYYY HH:mm\'}} </a> <table> <tr> <td class="text-left"> <button type="button" class="btn btn-primary btn-xs" ng-click="changeDate(-1, \'M\')"><i class="fa fa-chevron-left"></i> 1M</button> <button type="button" class="btn btn-primary btn-xs" ng-click="changeDate(-1, \'w\')"><i class="fa fa-chevron-left"></i> 1W</button> <button type="button" class="btn btn-primary btn-xs" ng-click="changeDate(-1, \'d\')"><i class="fa fa-chevron-left"></i> 1T</button> </td> <td class="text-right"> <button type="button" class="btn btn-primary btn-xs" ng-click="changeDate(1, \'d\')">1T <i class="fa fa-chevron-right"></i></button> <button type="button" class="btn btn-primary btn-xs" ng-click="changeDate(1, \'w\')">1W <i class="fa fa-chevron-right"></i></button> <button type="button" class="btn btn-primary btn-xs" ng-click="changeDate(1, \'M\')">1M <i class="fa fa-chevron-right"></i></button> </td> </tr> </table> </div> <canvas class="chart-base live-chart" chart-type="model.chart.options.type" chart-options="model.chart.options" chart-data="model.chart.data" chart-labels="model.chart.labels" chart-series="model.chart.series"></canvas> <div class="update-chart" ng-hide="!updateChartState"> <i class="fa fa-refresh fa-spin fa-fw"></i>Lade Daten &amp; Aktualisiere Diagramm </div> </div> </div> <div class="stats panel panel-default" ng-if="model.stats.length"> <div class="panel-heading"><strong>Statistiken</strong></div> <div class="panel-body"> <div class="container-fluid" ng-hide="updateChartState"> <div class="row" ng-repeat="stat in model.stats"> <div class="col-md-3"><strong>{{stat.title}}</strong></div> <div class="col-md-9"> <div stat="stat.value"></div> </div> </div> </div> </div> </div> </div>'),a.put("views/shows.html",'<div class="content max-width fade-animate" ng-if="initFinished"> <div class="select"> <div class="select-heading container-fluid" ng-if="shows.length"> <div class="row"> <div class="col-md-3 form-group"> <label>Format</label> <ui-select ng-model="show.selected" on-select="update()"> <ui-select-match placeholder="Auswählen.."> <span ng-bind="$select.selected"></span> </ui-select-match> <ui-select-choices repeat="item in (shows | filter: $select.search | orderBy)"> <span ng-bind="item"></span> </ui-select-choices> </ui-select> </div> <div class="col-md-3 form-group" ng-if="model.seriesList.length"> <label>Serie</label> <ui-select ng-model="series.selected" on-select="update()"> <ui-select-match allow-clear="true" placeholder="Auswählen.."> <span ng-bind="$select.selected"></span> </ui-select-match> <ui-select-choices repeat="item in (model.seriesList | filter: $select.search | orderBy)"> <span ng-bind="item"></span> </ui-select-choices> </ui-select> </div> </div> </div> <div class="select-body"> <div class="select-content fade-animate" animate-change="model.show" ng-if="model.show == show.selected"> <div class="stats panel panel-default" ng-if="model.stats.length"> <div class="panel-heading"><strong>Statistiken</strong></div> <div class="panel-body"> <div class="container-fluid"> <div class="row" ng-repeat="stat in model.stats"> <div class="col-md-3"><strong>{{stat.title}}</strong></div> <div class="col-md-9"> <div stat="stat.value"></div> </div> </div> </div> </div> </div> <div class="chart panel panel-default" ng-repeat="chart in model.charts"> <div class="panel-heading"><strong>{{chart.options.header}}</strong></div> <div class="panel-body" style="width:{{chart.options.width}}; height: {{chart.options.height}}"> <canvas class="chart-base" chart-type="chart.options.type" chart-options="chart.options" chart-data="chart.data" chart-labels="chart.labels" chart-series="chart.series"></canvas> </div> </div> <div class="panel panel-default" ng-if="model.videos.length"> <div class="panel-heading"><strong>Videos</strong></div> <div class="panel-body container-table"> <div params="model.tableParams" videos="model.videos"></div> </div> </div> </div> </div> </div> </div>'),a.put("views/template-flag.html",'<div class="modal-header"> <h3 class="modal-title" id="modal-title">Fehler melden</h3> </div> <div class="modal-body" id="modal-body"> <form class="form-horizontal"> <fieldset> <!-- Multiple Checkboxes --> <div class="form-group"> <label class="col-md-4 control-label" for="checkboxes">Grund</label> <div class="col-md-7"> <div class="checkbox" ng-repeat="reason in reasons"> <label for="checkboxes-{{$index}}"> <input id="checkboxes-{{$index}}" type="checkbox" name="checkboxes" value="{{$index}}" ng-model="reason.selected"> {{reason.title}} </label> </div> </div> </div> <!-- Textarea --> <div class="form-group"> <label class="col-md-4 control-label" for="textarea">Beschreibung<br><small>(optional)</small></label> <div class="col-md-7"> <textarea class="form-control" id="textarea" name="textarea" ng-model="description"></textarea> </div> </div> </fieldset> </form> </div> <div class="modal-footer"> <button class="btn btn-primary" type="button" ng-click="ok()">Melden</button> <button class="btn btn-default" type="button" ng-click="cancel()">Abbrechen</button> </div>'),a.put("views/template-stat.html",'<div ng-switch="getType(value)"> <!-- value: array --> <div class="array" ng-switch-when="array"> <div ng-repeat="value in value"> <div> <strong>{{$index + 1}}.</strong> </div> <div> <div stat="value"></div> </div> </div> </div> <!-- value: atomic --> <div ng-switch-default> <div ng-switch="value.type"> <!-- type: url --> <div ng-switch-when="url"> <a ng-href="{{value.url}}" scroll-to="top" blank>{{value.text}}</a> <span class="info" ng-if="value.info"> • {{value.info}}</span> </div> <!-- type: duration --> <div ng-switch-when="duration"> <span ng-if="!value.url">{{value.text | duration}}</span> <span class="info" ng-if="value.info"> • {{value.info}}</span> </div> <!-- type: default --> <div ng-switch-default> {{value.text}} <span class="info" ng-if="value.info"> • {{value.info}}</span> </div> </div> </div> </div>'),a.put("views/template-videos.html",'<table class="table table-striped" ng-table="tableParams" show-filter="true"> <tr ng-repeat="video in $data"> <td width="20"><a href="" title="Fehler melden" ng-click="openFlagDialog(video.id)"><i class="fa fa-flag"></i></a></td> <td title="\'Titel\'" filter="{ title: \'text\'}" data-sortable="\'title\'"><a target="_blank" href="https://www.youtube.com/watch?v={{video.id}}">{{video.title}}</a></td> <td width="140" filter="{ hosts: \'text\'}" title="\'Personen\'" data-sortable="\'hosts\'"> <span ng-repeat="host in video.hosts | orderBy"> <a ng-href="#/hosts?host={{host}}" ng-click="scrollTop()">{{host}}</a><span ng-if="$index < video.hosts.length - 1">,</span> </span> </td> <td width="140" filter="{ shows: \'text\'}" title="\'Formate\'" data-sortable="\'shows\'"> <span ng-repeat="show in video.shows | orderBy"> <a ng-href="#/shows?show={{show | escape}}" ng-click="scrollTop()">{{show}}</a><span ng-if="$index < video.shows.length - 1">,</span> </span> </td> <td width="140" filter="{ channel: \'select\'}" filter-data="getSelectFilter(\'channel\')" title="\'Kanal\'" data-sortable="\'channel\'">{{video.channel}}</td> <td width="80" title="\'Laufzeit\'" data-sortable="\'length\'">{{video.length | duration}}</td> <td width="80" title="\'Upload\'" data-sortable="\'published\'">{{video.published | createDate | date:"dd.MM.yyyy"}}</td> <td width="80" title="\'Ausstrahlung\'" data-sortable="\'aired\'"><a ng-href="#/live?from={{getLiveFrom(video)}}&to={{getLiveTo(video)}}">{{video.aired | createDate | date:"dd.MM.yyyy"}}</a></td> <td width="60" title="\'Views\'" data-sortable="\'stats.viewCount\'">{{video.stats.viewCount}}</td> <td width="60" title="\'Likes\'" data-sortable="\'stats.likeCount\'">{{video.stats.likeCount}}</td> <td width="60" title="\'Dislikes\'" data-sortable="\'stats.dislikeCount\'">{{video.stats.dislikeCount}}</td> </tr> </table>'),a.put("views/videos.html",'<div class="content max-width fade-animate" ng-if="initFinished"> <div class="panel panel-default fade-animate" ng-if="videos.length"> <div class="panel-heading"><strong>Videos</strong></div> <div class="panel-body container-table"> <div params="model.tableParams" videos="videos"></div> </div> </div> </div>')}]);